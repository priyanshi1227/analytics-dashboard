{% extends "base.html" %}

{% block title %}Dashboard - AI Analytics{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Analytics Dashboard</h1>
        <p class="text-gray-600 dark:text-gray-400">Real-time insights and performance metrics</p>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- DAU -->
        <div class="stat-card card p-6 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-100 dark:border-blue-800/30">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-blue-600 dark:text-blue-400 mb-1">Daily Active Users</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">12,847</p>
                </div>
                <div class="p-3 bg-white/50 dark:bg-blue-800/30 rounded-xl shadow-sm">
                    <i class="fas fa-users text-blue-500 dark:text-blue-300 text-xl"></i>
                </div>
            </div>
            <div class="mt-3 flex items-center">
                <div class="w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center mr-2">
                    <i class="fas fa-arrow-up text-green-600 dark:text-green-400 text-xs"></i>
                </div>
                <span class="text-sm font-medium text-green-600 dark:text-green-400">2.8%</span>
                <span class="text-sm text-gray-500 dark:text-gray-400 ml-2">vs yesterday</span>
            </div>
        </div>

        <!-- MAU -->
        <div class="stat-card card p-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-100 dark:border-green-800/30">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-green-600 dark:text-green-400 mb-1">Monthly Active Users</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">284,562</p>
                </div>
                <div class="p-3 bg-white/50 dark:bg-green-800/30 rounded-xl shadow-sm">
                    <i class="fas fa-user-friends text-green-500 dark:text-green-300 text-xl"></i>
                </div>
            </div>
            <div class="mt-3 flex items-center">
                <div class="w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center mr-2">
                    <i class="fas fa-arrow-up text-green-600 dark:text-green-400 text-xs"></i>
                </div>
                <span class="text-sm font-medium text-green-600 dark:text-green-400">4.1%</span>
                <span class="text-sm text-gray-500 dark:text-gray-400 ml-2">vs last month</span>
            </div>
        </div>

        <!-- Retention -->
        <div class="stat-card card p-6 bg-gradient-to-br from-purple-50 to-violet-50 dark:from-purple-900/20 dark:to-violet-900/20 border border-purple-100 dark:border-purple-800/30">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-purple-600 dark:text-purple-400 mb-1">Retention Rate</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">68.2%</p>
                </div>
                <div class="p-3 bg-white/50 dark:bg-purple-800/30 rounded-xl shadow-sm">
                    <i class="fas fa-chart-line text-purple-500 dark:text-purple-300 text-xl"></i>
                </div>
            </div>
            <div class="mt-3 flex items-center">
                <div class="w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center mr-2">
                    <i class="fas fa-arrow-up text-green-600 dark:text-green-400 text-xs"></i>
                </div>
                <span class="text-sm font-medium text-green-600 dark:text-green-400">5.2%</span>
                <span class="text-sm text-gray-500 dark:text-gray-400 ml-2">improvement</span>
            </div>
        </div>

        <!-- North Star -->
        <div class="stat-card card p-6 bg-gradient-to-br from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 border border-orange-100 dark:border-orange-800/30">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-orange-600 dark:text-orange-400 mb-1">North Star Metric</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">78.5</p>
                </div>
                <div class="p-3 bg-white/50 dark:bg-orange-800/30 rounded-xl shadow-sm">
                    <i class="fas fa-star text-orange-500 dark:text-orange-300 text-xl"></i>
                </div>
            </div>
            <div class="mt-3">
                <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-1">
                    <span>Progress</span>
                    <span>Target: 85</span>
                </div>
                <div class="w-full bg-gray-200/50 dark:bg-gray-700/50 rounded-full h-2">
                    <div class="bg-gradient-to-r from-orange-500 to-amber-500 h-2 rounded-full transition-all duration-500 ease-out" style="width: 78.5%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Segmentation Section -->
    <div class="card p-6 mb-8 bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm border border-gray-200/50 dark:border-gray-700/50">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
            <div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">User Segmentation</h3>
                <p class="text-gray-600 dark:text-gray-400">Understand different user groups and their behaviors</p>
            </div>
            <div class="flex flex-wrap gap-2 mt-4 lg:mt-0">
                <button class="px-4 py-2 text-sm bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl shadow-sm shadow-blue-500/25 segment-filter active transition-all duration-200 hover:shadow-md hover:shadow-blue-500/30" data-segment="all">
                    All Users
                </button>
                <button class="px-4 py-2 text-sm bg-white/80 dark:bg-gray-700/80 text-gray-700 dark:text-gray-300 rounded-xl border border-gray-200 dark:border-gray-600 segment-filter transition-all duration-200 hover:bg-white dark:hover:bg-gray-600" data-segment="power">
                    Power Users
                </button>
                <button class="px-4 py-2 text-sm bg-white/80 dark:bg-gray-700/80 text-gray-700 dark:text-gray-300 rounded-xl border border-gray-200 dark:border-gray-600 segment-filter transition-all duration-200 hover:bg-white dark:hover:bg-gray-600" data-segment="regular">
                    Regular Users
                </button>
                <button class="px-4 py-2 text-sm bg-white/80 dark:bg-gray-700/80 text-gray-700 dark:text-gray-300 rounded-xl border border-gray-200 dark:border-gray-600 segment-filter transition-all duration-200 hover:bg-white dark:hover:bg-gray-600" data-segment="casual">
                    Casual Users
                </button>
            </div>
        </div>

        <!-- Segment Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="bg-gradient-to-br from-blue-500/10 to-blue-600/10 dark:from-blue-500/20 dark:to-blue-600/20 p-5 rounded-2xl border border-blue-200/50 dark:border-blue-700/50">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center mb-3">
                            <i class="fas fa-bolt text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <p class="text-sm font-medium text-blue-600 dark:text-blue-400 mb-1">Power Users</p>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">12.5K</p>
                    </div>
                </div>
                <p class="text-sm text-blue-600/80 dark:text-blue-400/80 mt-2">12.5% of total</p>
            </div>

            <div class="bg-gradient-to-br from-green-500/10 to-green-600/10 dark:from-green-500/20 dark:to-green-600/20 p-5 rounded-2xl border border-green-200/50 dark:border-green-700/50">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center mb-3">
                            <i class="fas fa-user text-green-600 dark:text-green-400"></i>
                        </div>
                        <p class="text-sm font-medium text-green-600 dark:text-green-400 mb-1">Regular Users</p>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">45.2K</p>
                    </div>
                </div>
                <p class="text-sm text-green-600/80 dark:text-green-400/80 mt-2">45.2% of total</p>
            </div>

            <div class="bg-gradient-to-br from-purple-500/10 to-purple-600/10 dark:from-purple-500/20 dark:to-purple-600/20 p-5 rounded-2xl border border-purple-200/50 dark:border-purple-700/50">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center mb-3">
                            <i class="fas fa-user-clock text-purple-600 dark:text-purple-400"></i>
                        </div>
                        <p class="text-sm font-medium text-purple-600 dark:text-purple-400 mb-1">Casual Users</p>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">32.8K</p>
                    </div>
                </div>
                <p class="text-sm text-purple-600/80 dark:text-purple-400/80 mt-2">32.8% of total</p>
            </div>

            <div class="bg-gradient-to-br from-gray-500/10 to-gray-600/10 dark:from-gray-500/20 dark:to-gray-600/20 p-5 rounded-2xl border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="w-10 h-10 bg-gray-100 dark:bg-gray-900/30 rounded-xl flex items-center justify-center mb-3">
                            <i class="fas fa-exclamation-triangle text-gray-600 dark:text-gray-400"></i>
                        </div>
                        <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">At Risk</p>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">8.4K</p>
                    </div>
                </div>
                <p class="text-sm text-gray-600/80 dark:text-gray-400/80 mt-2">8.4% of total</p>
            </div>
        </div>

        <!-- Segmentation Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200/50 dark:border-gray-700/50">
                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">User Distribution</h4>
                <div class="h-80 relative">
                    <canvas id="segmentationChart"></canvas>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200/50 dark:border-gray-700/50">
                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Behavior Comparison</h4>
                <div class="h-80 relative">
                    <canvas id="segmentBehaviorChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Metrics Section -->
    <div class="card p-6 mb-8 bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm border border-gray-200/50 dark:border-gray-700/50">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
            <div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Performance Metrics</h3>
                <p class="text-gray-600 dark:text-gray-400">Track key performance indicators and system health</p>
            </div>
            <div class="flex flex-wrap gap-2 mt-4 lg:mt-0">
                <button class="px-4 py-2 text-sm bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl shadow-sm shadow-blue-500/25 performance-filter active transition-all duration-200 hover:shadow-md hover:shadow-blue-500/30" data-metric="engagement">
                    Engagement
                </button>
                <button class="px-4 py-2 text-sm bg-white/80 dark:bg-gray-700/80 text-gray-700 dark:text-gray-300 rounded-xl border border-gray-200 dark:border-gray-600 performance-filter transition-all duration-200 hover:bg-white dark:hover:bg-gray-600" data-metric="technical">
                    Technical
                </button>
                <button class="px-4 py-2 text-sm bg-white/80 dark:bg-gray-700/80 text-gray-700 dark:text-gray-300 rounded-xl border border-gray-200 dark:border-gray-600 performance-filter transition-all duration-200 hover:bg-white dark:hover:bg-gray-600" data-metric="business">
                    Business
                </button>
            </div>
        </div>

        <!-- Performance Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200/50 dark:border-gray-700/50 hover:shadow-md transition-all duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center">
                        <i class="fas fa-clock text-blue-600 dark:text-blue-400 text-lg"></i>
                    </div>
                    <div class="w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                        <i class="fas fa-arrow-up text-green-600 dark:text-green-400 text-xs"></i>
                    </div>
                </div>
                <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Avg Session</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white mb-1">4m 32s</p>
                <p class="text-xs text-green-600 dark:text-green-400 font-medium">+2.3% from last week</p>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200/50 dark:border-gray-700/50 hover:shadow-md transition-all duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center">
                        <i class="fas fa-mouse text-green-600 dark:text-green-400 text-lg"></i>
                    </div>
                    <div class="w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                        <i class="fas fa-arrow-up text-green-600 dark:text-green-400 text-xs"></i>
                    </div>
                </div>
                <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Pages/Session</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white mb-1">5.8</p>
                <p class="text-xs text-green-600 dark:text-green-400 font-medium">+1.7% from last week</p>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200/50 dark:border-gray-700/50 hover:shadow-md transition-all duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center">
                        <i class="fas fa-tachometer-alt text-purple-600 dark:text-purple-400 text-lg"></i>
                    </div>
                    <div class="w-8 h-8 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center">
                        <i class="fas fa-arrow-down text-red-600 dark:text-red-400 text-xs"></i>
                    </div>
                </div>
                <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Load Time</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white mb-1">1.2s</p>
                <p class="text-xs text-red-600 dark:text-red-400 font-medium">-0.8% from last week</p>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-sm border border-gray-200/50 dark:border-gray-700/50 hover:shadow-md transition-all duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-xl flex items-center justify-center">
                        <i class="fas fa-percentage text-orange-600 dark:text-orange-400 text-lg"></i>
                    </div>
                    <div class="w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                        <i class="fas fa-arrow-down text-green-600 dark:text-green-400 text-xs"></i>
                    </div>
                </div>
                <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Bounce Rate</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white mb-1">42%</p>
                <p class="text-xs text-green-600 dark:text-green-400 font-medium">-3.2% from last week</p>
            </div>
        </div>

        <!-- Performance Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200/50 dark:border-gray-700/50">
                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Performance Trends</h4>
                <div class="h-80 relative">
                    <canvas id="performanceTrendsChart"></canvas>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200/50 dark:border-gray-700/50">
                <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Performance Goals</h4>
                <div class="h-80 relative">
                    <canvas id="performanceGoalsChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- DAU/MAU Chart -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200/50 dark:border-gray-700/50">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-1">DAU/MAU Trend</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Daily and monthly active user engagement</p>
                </div>
                <div class="flex space-x-2 mt-4 lg:mt-0">
                    <button class="px-4 py-2 text-sm bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl shadow-sm shadow-blue-500/25 time-filter active transition-all duration-200 hover:shadow-md hover:shadow-blue-500/30" data-days="7">7D</button>
                    <button class="px-4 py-2 text-sm bg-white/80 dark:bg-gray-700/80 text-gray-700 dark:text-gray-300 rounded-xl border border-gray-200 dark:border-gray-600 time-filter transition-all duration-200 hover:bg-white dark:hover:bg-gray-600" data-days="30">30D</button>
                    <button class="px-4 py-2 text-sm bg-white/80 dark:bg-gray-700/80 text-gray-700 dark:text-gray-300 rounded-xl border border-gray-200 dark:border-gray-600 time-filter transition-all duration-200 hover:bg-white dark:hover:bg-gray-600" data-days="90">90D</button>
                </div>
            </div>
            <div class="h-80 relative">
                <canvas id="dauMauChart"></canvas>
            </div>
        </div>

        <!-- KPI Hierarchy -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200/50 dark:border-gray-700/50">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">KPI Hierarchy</h3>
            <div class="h-80 relative">
                <canvas id="kpiHierarchyChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Feature Heatmap & Correlation Matrix -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <!-- Feature Adoption Heatmap -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200/50 dark:border-gray-700/50">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Feature Adoption Heatmap</h3>
            <div class="h-80 relative">
                <canvas id="featureHeatmap"></canvas>
            </div>
        </div>

        <!-- Correlation Matrix -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200/50 dark:border-gray-700/50">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Metric Correlation Matrix</h3>
            <div class="h-80 relative">
                <canvas id="correlationMatrix"></canvas>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <a href="/ai-recommendations" class="group bg-white dark:bg-gray-800 rounded-2xl p-6 text-center shadow-sm border border-gray-200/50 dark:border-gray-700/50 hover:shadow-lg hover:border-blue-200 dark:hover:border-blue-700 transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
            <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                <i class="fas fa-robot text-white text-xl"></i>
            </div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">AI Recommendations</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">Get data-driven insights</p>
        </a>

        <a href="/anomaly-detection" class="group bg-white dark:bg-gray-800 rounded-2xl p-6 text-center shadow-sm border border-gray-200/50 dark:border-gray-700/50 hover:shadow-lg hover:border-red-200 dark:hover:border-red-700 transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
            <div class="w-14 h-14 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                <i class="fas fa-search text-white text-xl"></i>
            </div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Anomaly Detection</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">Find unusual patterns</p>
        </a>

        <a href="/data-export" class="group bg-white dark:bg-gray-800 rounded-2xl p-6 text-center shadow-sm border border-gray-200/50 dark:border-gray-700/50 hover:shadow-lg hover:border-green-200 dark:hover:border-green-700 transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
            <div class="w-14 h-14 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                <i class="fas fa-file-export text-white text-xl"></i>
            </div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Data Export</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">Export your analytics</p>
        </a>

        <a href="/custom-reports" class="group bg-white dark:bg-gray-800 rounded-2xl p-6 text-center shadow-sm border border-gray-200/50 dark:border-gray-700/50 hover:shadow-lg hover:border-purple-200 dark:hover:border-purple-700 transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
            <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                <i class="fas fa-chart-bar text-white text-xl"></i>
            </div>
            <h3 class="font-semibold text-gray-900 dark:text-white mb-2">Custom Reports</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">Create custom reports</p>
        </a>
    </div>

    <!-- AI Recommendations -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200/50 dark:border-gray-700/50">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
            <div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">AI Recommendations</h3>
                <p class="text-gray-600 dark:text-gray-400">Smart insights powered by artificial intelligence</p>
            </div>
            <button onclick="loadAIRecommendations()" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl shadow-sm shadow-blue-500/25 transition-all duration-200 hover:shadow-md hover:shadow-blue-500/30 transform hover:-translate-y-0.5 mt-4 lg:mt-0">
                <i class="fas fa-robot mr-2"></i>Generate New
            </button>
        </div>
        <div id="aiRecommendations" class="space-y-4">
            <!-- AI recommendations will be loaded here -->
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Chart instances
    let dauMauChart = null;
    let kpiHierarchyChart = null;
    let featureHeatmapChart = null;
    let correlationMatrixChart = null;
    let segmentationChart = null;
    let segmentBehaviorChart = null;
    let performanceTrendsChart = null;
    let performanceGoalsChart = null;

    // Initialize dashboard when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Initializing charts...');
        initializeAllCharts();
        setupEventListeners();
        loadAIRecommendations();
    });

    function setupEventListeners() {
        // Time filters
        document.querySelectorAll('.time-filter').forEach(button => {
            button.addEventListener('click', function() {
                updateActiveState(this, '.time-filter');
                const days = parseInt(this.dataset.days);
                console.log('Changing time range to:', days + ' days');
                renderDAUMAUChart(days);
            });
        });

        // Segment filters
        document.querySelectorAll('.segment-filter').forEach(button => {
            button.addEventListener('click', function() {
                updateActiveState(this, '.segment-filter');
                filterDataBySegment(this.dataset.segment);
            });
        });

        // Performance filters
        document.querySelectorAll('.performance-filter').forEach(button => {
            button.addEventListener('click', function() {
                updateActiveState(this, '.performance-filter');
                filterPerformanceData(this.dataset.metric);
            });
        });
    }

    function updateActiveState(activeElement, selector) {
        document.querySelectorAll(selector).forEach(btn => {
            btn.classList.remove('bg-gradient-to-r', 'from-blue-500', 'to-blue-600', 'text-white', 'shadow-blue-500/25');
            btn.classList.add('bg-white/80', 'dark:bg-gray-700/80', 'text-gray-700', 'dark:text-gray-300', 'border');
        });
        activeElement.classList.remove('bg-white/80', 'dark:bg-gray-700/80', 'text-gray-700', 'dark:text-gray-300', 'border');
        activeElement.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-blue-600', 'text-white', 'shadow-blue-500/25');
    }

    function initializeAllCharts() {
        console.log('Creating all charts...');
        renderDAUMAUChart(30);
        renderKPIHierarchy();
        renderFeatureHeatmap();
        renderCorrelationMatrix();
        renderSegmentationCharts();
        renderPerformanceCharts();
        console.log('All charts initialized!');
    }

    function renderDAUMAUChart(days = 30) {
        const ctx = document.getElementById('dauMauChart');
        if (!ctx) {
            console.error('DAU/MAU chart canvas not found!');
            return;
        }

        if (dauMauChart) {
            dauMauChart.destroy();
        }

        const labels = generateDateLabels(days);
        const dauData = generateSampleData(12000, 15000, days);
        const mauData = generateSampleData(280000, 290000, days);

        console.log('Rendering DAU/MAU chart with', days, 'days of data');

        dauMauChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Daily Active Users',
                        data: dauData,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Monthly Active Users',
                        data: mauData,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    }

    function renderKPIHierarchy() {
        const ctx = document.getElementById('kpiHierarchyChart');
        if (!ctx) {
            console.error('KPI Hierarchy chart canvas not found!');
            return;
        }

        if (kpiHierarchyChart) {
            kpiHierarchyChart.destroy();
        }

        kpiHierarchyChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['User Engagement', 'Product Health', 'Business Value', 'Technical Performance', 'Customer Satisfaction'],
                datasets: [{
                    label: 'KPI Score',
                    data: [85, 92, 78, 88, 82],
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(139, 92, 246, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(239, 68, 68, 0.8)'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });
    }

    function renderFeatureHeatmap() {
        const ctx = document.getElementById('featureHeatmap');
        if (!ctx) {
            console.error('Feature Heatmap chart canvas not found!');
            return;
        }

        if (featureHeatmapChart) {
            featureHeatmapChart.destroy();
        }

        const features = ['Dashboard', 'Reports', 'AI Insights', 'Data Export', 'Custom Analytics'];
        const datasets = [
            {
                label: 'Power Users',
                data: [95, 88, 92, 85, 78],
                backgroundColor: 'rgba(59, 130, 246, 0.8)'
            },
            {
                label: 'Regular Users',
                data: [75, 82, 68, 72, 65],
                backgroundColor: 'rgba(16, 185, 129, 0.8)'
            },
            {
                label: 'Casual Users',
                data: [45, 52, 38, 42, 35],
                backgroundColor: 'rgba(139, 92, 246, 0.8)'
            }
        ];

        featureHeatmapChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: features,
                datasets: datasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    x: {
                        stacked: true
                    },
                    y: {
                        stacked: true,
                        max: 100
                    }
                }
            }
        });
    }

    function renderCorrelationMatrix() {
        const ctx = document.getElementById('correlationMatrix');
        if (!ctx) {
            console.error('Correlation Matrix chart canvas not found!');
            return;
        }

        if (correlationMatrixChart) {
            correlationMatrixChart.destroy();
        }

        correlationMatrixChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['DAU', 'Retention', 'Revenue', 'Engagement', 'Sessions'],
                datasets: [{
                    label: 'Correlation Strength',
                    data: [0.85, 0.78, 0.72, 0.91, 0.75],
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(139, 92, 246, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(239, 68, 68, 0.8)'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 1
                    }
                }
            }
        });
    }

    function renderSegmentationCharts() {
        const segCtx = document.getElementById('segmentationChart');
        const behaviorCtx = document.getElementById('segmentBehaviorChart');

        if (!segCtx || !behaviorCtx) {
            console.error('Segmentation chart canvases not found!');
            return;
        }

        if (segmentationChart) segmentationChart.destroy();
        if (segmentBehaviorChart) segmentBehaviorChart.destroy();

        // Segmentation Pie Chart
        segmentationChart = new Chart(segCtx, {
            type: 'doughnut',
            data: {
                labels: ['Power Users', 'Regular Users', 'Casual Users', 'At Risk'],
                datasets: [{
                    data: [12.5, 45.2, 32.8, 9.5],
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(139, 92, 246, 0.8)',
                        'rgba(245, 158, 11, 0.8)'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Segment Behavior Comparison
        segmentBehaviorChart = new Chart(behaviorCtx, {
            type: 'radar',
            data: {
                labels: ['Engagement', 'Retention', 'Revenue', 'Activity', 'Satisfaction'],
                datasets: [
                    {
                        label: 'Power Users',
                        data: [95, 88, 92, 98, 90],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.2)'
                    },
                    {
                        label: 'Regular Users',
                        data: [75, 82, 68, 70, 78],
                        borderColor: 'rgb(16, 185, 129)',
                        backgroundColor: 'rgba(16, 185, 129, 0.2)'
                    },
                    {
                        label: 'Casual Users',
                        data: [45, 38, 52, 40, 48],
                        borderColor: 'rgb(139, 92, 246)',
                        backgroundColor: 'rgba(139, 92, 246, 0.2)'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });
    }

    function renderPerformanceCharts() {
        const trendsCtx = document.getElementById('performanceTrendsChart');
        const goalsCtx = document.getElementById('performanceGoalsChart');

        if (!trendsCtx || !goalsCtx) {
            console.error('Performance chart canvases not found!');
            return;
        }

        if (performanceTrendsChart) performanceTrendsChart.destroy();
        if (performanceGoalsChart) performanceGoalsChart.destroy();

        // Performance Trends Chart
        performanceTrendsChart = new Chart(trendsCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                datasets: [
                    {
                        label: 'Session Duration (min)',
                        data: [3.8, 4.1, 4.3, 4.2, 4.4, 4.6, 4.5],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Pages/Session',
                        data: [4.8, 5.2, 5.5, 5.3, 5.6, 5.8, 5.9],
                        borderColor: 'rgb(16, 185, 129)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top'
                    }
                }
            }
        });

        // Performance Goals Chart
        performanceGoalsChart = new Chart(goalsCtx, {
            type: 'bar',
            data: {
                labels: ['Load Time', 'Bounce Rate', 'Conversion', 'Retention'],
                datasets: [{
                    label: 'Current',
                    data: [85, 65, 78, 82],
                    backgroundColor: 'rgba(59, 130, 246, 0.8)'
                }, {
                    label: 'Target',
                    data: [90, 75, 85, 90],
                    backgroundColor: 'rgba(16, 185, 129, 0.8)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });
    }

    // Utility functions
    function generateDateLabels(days) {
        const labels = [];
        for (let i = days - 1; i >= 0; i--) {
            const date = new Date();
            date.setDate(date.getDate() - i);
            labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
        }
        return labels;
    }

    function generateSampleData(min, max, days) {
        const data = [];
        let current = (min + max) / 2;
        for (let i = 0; i < days; i++) {
            current += (Math.random() - 0.5) * (max - min) * 0.1;
            current = Math.max(min, Math.min(max, current));
            data.push(Math.round(current));
        }
        return data;
    }

    function filterDataBySegment(segment) {
        console.log('Filtering by segment:', segment);
        showToast(`Showing data for ${segment} users`, 'info');
    }

    function filterPerformanceData(metric) {
        console.log('Filtering performance data by:', metric);
        showToast(`Showing ${metric} metrics`, 'info');
    }

    async function loadAIRecommendations() {
        const container = document.getElementById('aiRecommendations');

        // Show loading state
        container.innerHTML = `
            <div class="text-center py-8">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-600 dark:text-gray-400">Generating smart recommendations...</p>
            </div>
        `;

        // Simulate API call delay
        await new Promise(resolve => setTimeout(resolve, 1500));

        // Sample AI recommendations
        const recommendations = [
            {
                problem: "Low engagement among casual users",
                action: "Implement personalized onboarding flow for new users to increase feature discovery",
                impact: "high",
                priority: "high",
                ai_generated: true
            },
            {
                problem: "High bounce rate on analytics pages",
                action: "Optimize page load times and add loading states for better user experience",
                impact: "medium",
                priority: "medium",
                ai_generated: true
            },
            {
                problem: "Power users showing decreased activity",
                action: "Create advanced features and customization options to re-engage power users",
                impact: "high",
                priority: "high",
                ai_generated: true
            }
        ];

        renderAIRecommendations(recommendations);
    }

    function renderAIRecommendations(recommendations) {
        const container = document.getElementById('aiRecommendations');

        container.innerHTML = recommendations.map(rec => `
            <div class="flex items-start space-x-4 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-2xl border border-blue-200/50 dark:border-blue-700/50 hover:shadow-md transition-all duration-200">
                <div class="flex-shrink-0">
                    <div class="w-12 h-12 bg-white dark:bg-blue-800/30 rounded-xl flex items-center justify-center shadow-sm">
                        <i class="fas fa-lightbulb text-blue-600 dark:text-blue-400 text-lg"></i>
                    </div>
                </div>
                <div class="flex-1">
                    <h4 class="font-semibold text-gray-900 dark:text-white mb-2">${rec.problem}</h4>
                    <p class="text-gray-600 dark:text-gray-400 mb-3">${rec.action}</p>
                    <div class="flex items-center space-x-3">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300">
                            <i class="fas fa-bolt mr-1"></i>
                            Impact: ${rec.impact}
                        </span>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300">
                            <i class="fas fa-flag mr-1"></i>
                            ${rec.priority} priority
                        </span>
                        ${rec.ai_generated ? `
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300">
                            <i class="fas fa-robot mr-1"></i>
                            AI Generated
                        </span>
                        ` : ''}
                    </div>
                </div>
            </div>
        `).join('');
    }

    // Simple toast notification
    function showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `fixed top-4 right-4 px-6 py-3 rounded-xl shadow-lg text-white ${
            type === 'error' ? 'bg-red-500' : 'bg-blue-500'
        } z-50`;
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => {
            document.body.removeChild(toast);
        }, 3000);
    }

    // Export functions for global access
    window.loadAIRecommendations = loadAIRecommendations;
</script>

<style>
    .stat-card {
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.1);
    }

    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid #f3f4f6;
        border-top: 3px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .card {
        backdrop-filter: blur(8px);
    }

    button, a {
        transition: all 0.2s ease-in-out;
    }

    /* Ensure canvas containers have proper dimensions */
    .h-80 {
        min-height: 20rem;
    }
</style>
{% endblock %}